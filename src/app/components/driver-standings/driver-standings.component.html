<section>
  @defer (when loaded()) {
    <div class="select-menu">
      <button (click)="openMenu= 'driver-standing'" [class.button-active]="driverActive"
        (click)="driverActive = true;constructorActive = false "
        [style.backgroundImage]="'url(/assets/images/backgrounds/button-bg-1.jpg)'">DRIVERS</button>
      <button (click)="openMenu = 'constructor-standing'" [class.button-active]="constructorActive"
        (click)="constructorActive = true; driverActive = false"
        [style.backgroundImage]="'url(/assets/images/backgrounds/button-bg-2.png)'">CONSTRUCTOR</button>
        <div class="test-buttons-container">
        <button id="test-button" (click)="startSim(5)">Test</button>
                <button id="test-button" (click)="standingsDataService.stopSimulation()">cancel</button>


        </div>

    </div>
    <div class="standing-cards">
      @switch (openMenu) {
        @case ('constructor-standing') {
        <div class="fade-wrapper" @fadeSlide>
          @for (team of (constructors$ | async); track $index) {
            <div (click)="standingsDataService.openConstructorFullCard(team)" class="constructor-cards"
              [style.background]=" 'linear-gradient(to right,' + team.teamColor + ', transparent)'">
              <div class="team-constructor-name">
                <div class="team-logo"><img [src]="team.logoPath"></div>
                <div class="hyphen"></div>
                <div class="first-name">{{team.team}}</div>
              </div>
              <div class="constructor-position-points">
                <div class="points-wrapper">
                  <div class="position">Pos. {{$index + 1}}</div>
                  <div class="constructor-points">{{team.points}} PTS</div>
                </div>
                <div class="car-container">
                  <img [src]="team.carImagePath" alt="">
                </div>
              </div>
            </div>
          }
        </div>
      } 
        @case ('driver-standing') {
          <div class="fade-wrapper" @fadeSlide>
            @for (driver of (driversSimSorted$ | async); track trackByDriver($index, driver)) {
              <div
                (click)="standingsDataService.openDriverFullCard(driver)"
                class="driver-cards"
                              [style.background]="'linear-gradient(to right, ' + driver.base.assets.teamColor + ', transparent)'"

                appFlip
                @fadeSlide
                [@verticalMove]="(standingsDataService.driverStandingMap$ | async)?.[driver.base.driverNumber]?.position ?? 99">
                <div class="driver-number-container">
                  <h1>{{ driver.base.driverNumber}}</h1>
                </div>
                <div class="team-driver-name">
                  <div class="team-logo"><img [src]="driver.base.assets.teamLogo"></div>
                  <div class="hyphen"></div>
                  <div class="driver-name">
                    <div class="first-name">{{driver.base.driverName}}</div>
                  </div>
                </div>
                <div class="position-points">
                  <div class="points-wrapper">
                    <div class="position">Pos. {{$index + 1}}</div>
                    <div class="driver-points">{{driver.season.points}} PTS</div>
                    <span class="simulation-test">MONZA Simulation x2 Position: {{ (standingsDataService.driverStandingMap$ | async)?.[driver.base.driverNumber]?.position }}</span>
                    <span class="simulation-test"> Zeit: {{ (standingsDataService.simTime$ | async) | date:'HH:mm:ss' }}</span>
                  </div>
                  <div class="driver-image-container">
                    <img class="driver" [src]="driver.base.assets.image">
                  </div>
                </div>
              </div>
            }
          </div>
        }
      @default {
          <div class="fade-wrapper" @fadeSlide>
            @for (driver of (driversSimSorted$ | async); track trackByDriver($index, driver)) {
              <div
                (click)="standingsDataService.openDriverFullCard(driver)"
                class="driver-cards"
                              [style.background]="'linear-gradient(to right, ' + driver.base.assets.teamColor + ', transparent)'"

                appFlip
                @fadeSlide
                [@verticalMove]="(standingsDataService.driverStandingMap$ | async)?.[driver.base.driverNumber]?.position ?? 99">
              <div class="driver-number-container">
                <h1>{{ driver.base.driverNumber}}</h1>
              </div>
              <div class="team-driver-name">
                <div class="team-logo"><img [src]="driver.base.assets.teamLogo"></div>
                <div class="hyphen"></div>
                <div class="driver-name">
                  <div class="first-name">{{driver.base.driverName}}</div>
                </div>
              </div>
              <div class="position-points">
                <div class="points-wrapper">
                  <div class="position">Pos. {{$index + 1}}</div>
                  <div class="driver-points">{{driver.season.points}} PTS</div>
                  <span class="simulation-test">MONZA Simulation x2 Position: {{ (standingsDataService.driverStandingMap$ | async)?.[driver.base.driverNumber]?.position }}</span>
                  <span class="simulation-test"> Zeit: {{ (standingsDataService.simTime$ | async) | date:'HH:mm:ss' }}</span>
                </div>
                <div class="driver-image-container">
                  <img class="driver" [src]="driver.base.assets.image">
                </div>
              </div>
            </div>
          }
        </div> 
        }
      }
    </div>
  }

  @placeholder {
    <div class="f1-loading">
      <img src="/assets/images/spinners/spinner1.gif" alt="F1 Logo" class="spin-logo">
    </div>
  }

  @if ( standingsDataService.selectedUser) {
    <div class="overlay" (click)="standingsDataService.selectedUser = null"></div>
    <app-driver-fullcard [driver]="standingsDataService.selectedUser"></app-driver-fullcard>
  }

  @if ( standingsDataService.selectedConstructor) {
    <div class="overlay" (click)="standingsDataService.selectedConstructor = null"></div>
    <app-driver-fullcard [team]="standingsDataService.selectedConstructor"></app-driver-fullcard>
  }


</section>